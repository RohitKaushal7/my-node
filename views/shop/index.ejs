<%- include('../includes/head.ejs') %> 
    <link rel="stylesheet" href="css/404.css">
</head>
<body>
    <%- include('../includes/nav.ejs') %> 
    <main class="grey lighten-3">
        
            <h1 align= center>Shop</h1>
        
        <div class="row">
        <% if ( data.length > 0) { %>

            <% for (p of data) { %>

                <div class="col s12 m3">
                    <div class="card hoverable">
                        <div class="card-image">
                            <img src="<%= p.img %> " alt="">
                            <div class="card-title"><%= p.title %> </div>
                        </div>
                        <div class="card-content prod">
                            <p style="color:#444"> <em style="color:#777"></em> <br><%= p.desc %></p>
                            <div class="col s4 right price">$<%= p.price %> </div>
                        </div>
                        <div class="card-action ">
                            <form class="tocart" style="display: inline-block;" method="POST">
                                <button type="submit" class="btn-flat waves-effect green lighten-5">Add to Cart</button>
                                <input type="hidden" name="productId" value="<%= p.id %>">
                            </form>
                            <form style="display: inline-block;" action="/products/<%= p.id %>" method="GET">
                                    <button type="submit" class="btn-flat waves-effect green lighten-5">See More</button>
                                </form>
                                
                        </div>
                    </div>
                </div>
                
                <% } %>

        <% } else { %>
            <h3>No Products here..!</h3>
            <% } %>
        </div>
    </main>

    <script>
        document.querySelectorAll('.tocart').forEach(plus=>{
                plus.addEventListener('submit',function(e){
                    e.preventDefault();
                    var xhr = new XMLHttpRequest();
                    id = this.productId.value;
                    xhr.open('POST','/cart',true);
                    xhr.setRequestHeader('Content-type','application/x-www-form-urlencoded');
                    xhr.send(`productId=${id}`);
                    xhr.onreadystatechange = function (){
                        if(xhr.readyState === 4){
                            if(xhr.status === 200){
                                M.toast({html: 'Product Added.!'})
                                }
                            }
                        }
                    })
            })
    </script>

<%- include('../includes/end.ejs') %> 